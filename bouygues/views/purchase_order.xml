<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="bouygues_purchase_order_form_view" model="ir.ui.view">
            <field name="name">bouygues.purchase.order.form</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='incoterm_id']" position="after">
                    <field name="is_subcontract" invisible="1"/>
                    <field name="partner_shipping_id"/>
                    <field name="shipping_name" attrs="{'invisible': [('partner_shipping_id', '=', False)]}"/>
                    <field name="shipping_street" attrs="{'invisible': [('partner_shipping_id', '=', False)]}"/>
                    <field name="shipping_zip" attrs="{'invisible': [('partner_shipping_id', '=', False)]}"/>
                    <field name="shipping_city" attrs="{'invisible': [('partner_shipping_id', '=', False)]}"/>
                </xpath>
                <xpath expr="//field[@name='incoterm_id']" position="after">
                    <field name="type" options="{'no_create_edit': True}"/>
                </xpath>
                <xpath expr="//field[@name='is_shipped']" position="attributes">
                    <attribute name="invisible">0</attribute>
                </xpath>
                <xpath expr="//button[@name='button_unlock']" position="attributes">
                    <attribute name="groups">bouygues.bouygues_manager_sales_group,base.group_system</attribute>
                </xpath>
                <xpath expr="//button[@name='action_rfq_send'][3]" position="attributes">
                    <attribute name="attrs">{'invisible': [('state', 'not in', ['purchase', 'done'])]}</attribute>
                </xpath>
                <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="domain">['&amp;', '|', ('company_id', '=',False), ('company_id', '=',company_id), ('is_supplier', '=', True)]</attribute>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree//field[@name='name']" position="after">
                    <field name="internal_ref" attrs="{'column_invisible': [('parent.is_materiel_company', '=', True)]}" optional="show"/>
                    <field name="manual_internal_ref" attrs="{'column_invisible': [('parent.is_materiel_company', '!=', True)]}" optional="show"/>
                    <field name="supplier_ref" optional="show"/>
                    <field name="origin_document" optional="show"/>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree//field[@name='product_template_id']" position="before">
                    <field name="line_sequence" optional="show"/>
                    <field name="analytic_imputation_id" domain="['&amp;', '&amp;', ('used_in_po', '=', True), ('company_id', '=', parent.company_id), '|', ('id', 'in', parent.analytic_imputation_all_child_ids), ('id', '=', parent.analytic_imputation_id)]" options="{'no_create_edit': True}" optional="show"/>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree//field[@name='price_unit']" position="after">
                    <field name="discount" optional="show"/>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree//field[@name='qty_received']" position="after">
                    <button name="add_received" type="object" icon="fa-truck" title="Add received qty" aria-label="Add received qty" attrs="{'invisible': ['|', ('state', 'not in', ('done')), ('product_type', 'in', ('consu', 'product'))]}"/>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree//field[@name='product_template_id']" position="attributes">
                    <attribute name="optional">show</attribute>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree//field[@name='name']" position="attributes">
                    <attribute name="optional">show</attribute>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree//field[@name='product_qty']" position="attributes">
                    <attribute name="optional">show</attribute>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree//field[@name='price_unit']" position="attributes">
                    <attribute name="optional">show</attribute>
                </xpath>
                <xpath expr="//field[@name='order_line']//tree//field[@name='price_subtotal']" position="attributes">
                    <attribute name="optional">show</attribute>
                </xpath>
                <xpath expr="///field[@name='order_line']//tree//field[@name='price_unit']" position="after">
                    <field name="can_edit_price" invisible="1"/>
                    <button name="edit_price_unit" type="object" icon="fa-euro" title="Edit Price Unit" aria-label="Edit Price Unit" attrs="{'invisible': ['|', ('state', 'not in', ['done']), ('can_edit_price', '=', False)]}"/>
                </xpath>
                <xpath expr="//field[@name='order_line']//form//field[@name='company_id']" position="after">
                    <field name="sale_order_ids">
                        <tree>
                            <field name="state" invisible="1"/>
                            <field name="name"/>
                        </tree>
                    </field>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="before">
                    <field name="real_delivery_date"/>
                    <field name="is_materiel_company" invisible="1"/>
                    <field name="is_materiel_company" invisible="1"/>
                </xpath>
                <xpath expr="//page[@name='purchase_delivery_invoice']" position="after">
                    <page name="sale_order_note" string="Sale Order Note">
                        <group>
                            <field name="dropship_note"/>
                        </group>
                    </page>
                </xpath>
                <xpath expr="//page[@name='purchase_delivery_invoice']//field[@name='dest_address_id']" position="after">
                        <field name="picking_contact_id" attrs="{'invisible': [('picking_contact_id', '=', False)]}"/>
                        <field name="contact_phone" widget="phone" attrs="{'invisible': [('contact_phone', '=', False)]}"/>
                        <field name="contact_mobile" widget="phone" attrs="{'invisible': [('contact_mobile', '=', False)]}"/>
                        <field name="purchase_picking_contact_id" attrs="{'invisible': [('picking_contact_id', '=', True)]}"/>
                        <field name="purchase_contact_phone" widget="phone" attrs="{'invisible': [('purchase_contact_phone', '=', False)]}"/>
                        <field name="purchase_contact_mobile" widget="phone" attrs="{'invisible': [('purchase_contact_mobile', '=', False)]}"/>
                </xpath>
                <xpath expr="//page[@name='purchase_delivery_invoice']//field[@name='user_id']" position="after">
                    <field name="responsible_id"/>
                </xpath>
                <xpath expr="//field[@name='state']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="replace">
                    <field name="create_date" string="Order Date"/>
                </xpath>
                <xpath expr="//field[@name='state']" position="after">
                    <field name="po_state" widget="statusbar" statusbar_visible="draft,sent,purchase,total_sale,partial_sale,partial_ship"/>
                </xpath>
                <xpath expr="//sheet//button[@name='action_view_invoice']" position="before">
                    <button type="object"
                       name="action_view_orders"
                       class="oe_stat_button"
                       icon="fa-shopping-cart"
                       attrs="{'invisible': [('sale_order_count', '=', 0)]}">
                       <field name="sale_order_count" widget="statinfo" string="Sale Orders"/>
                    </button>
                </xpath>
                <xpath expr="//field[@name='company_id']" position="after">
                    <field name="analytic_imputation_id" required="1" options="{'no_create_edit': True}"/>
                    <field name="analytic_imputation_all_child_ids" invisible="1"/>
                </xpath>
                <xpath expr="//page[@name='purchase_delivery_invoice']" position="after">
                    <page name="warehouse_page" string="Warehouse Information">
                        <group>
                            <field name="warehouse_text_printed"/>
                            <field name="ditrl_text"/>
                            <field name="dichm_text"/>
                            <field name="paqtl_text"/>
                            <field name="locd_text"/>
                        </group>
                    </page>
                    <page string="Purchase Validation" name="purchase_validation" attrs="{'invisible': [('use_validation', '=', False)]}">
                        <group>
                            <group>
                                <field name="validation_limit_1_user_id" attrs="{'invisible': [('validation_1_needed', '=', False)], 'readonly': ['|', ('to_be_approved', '=', True), ('approved', '=', True)]}"/>
                                <field name="validation_limit_2_user_id" attrs="{'invisible': [('validation_2_needed', '=', False)], 'readonly': ['|', ('to_be_approved', '=', True), ('approved', '=', True)]}"/>
                                <field name="validation_limit_3_user_id" attrs="{'invisible': [('validation_3_needed', '=', False)], 'readonly': ['|', ('to_be_approved', '=', True), ('approved', '=', True)]}"/>
                                <field name="validation_limit_4_user_id" attrs="{'invisible': [('validation_4_needed', '=', False)], 'readonly': ['|', ('to_be_approved', '=', True), ('approved', '=', True)]}"/>
                                <field name="validation_limit_5_user_id" attrs="{'invisible': [('validation_5_needed', '=', False)], 'readonly': ['|', ('to_be_approved', '=', True), ('approved', '=', True)]}"/>
                                <field name="approved" invisible="1"/>
                                <field name="refused" invisible="1"/>
                                <field name="to_be_approved" invisible="1"/>
                                <field name="use_validation" invisible="1"/>
                            </group>
                            <group>
                                <field name="validation_1_date" attrs="{'invisible': [('validation_1_needed', '=', False)]}"/>
                                <field name="validation_2_date" attrs="{'invisible': [('validation_2_needed', '=', False)]}"/>
                                <field name="validation_3_date" attrs="{'invisible': [('validation_3_needed', '=', False)]}"/>
                                <field name="validation_4_date" attrs="{'invisible': [('validation_4_needed', '=', False)]}"/>
                                <field name="validation_5_date" attrs="{'invisible': [('validation_5_needed', '=', False)]}"/>
                                <field name="validation_1" string="Validated 1" invisible="1"/>
                                <field name="validation_2" string="Validated 2" invisible="1"/>
                                <field name="validation_3" string="Validated 3" invisible="1"/>
                                <field name="validation_4" string="Validated 4" invisible="1"/>
                                <field name="validation_5" string="Validated 5" invisible="1"/>
                                <field name="validation_1_needed" string="Validated 1" invisible="1"/>
                                <field name="validation_2_needed" string="Validated 2" invisible="1"/>
                                <field name="validation_3_needed" string="Validated 3" invisible="1"/>
                                <field name="validation_4_needed" string="Validated 4" invisible="1"/>
                                <field name="validation_5_needed" string="Validated 5" invisible="1"/>
                            </group>

                        </group>
                        <group>
                            <field name="refused_id" attrs="{'invisible': [('refused', '=', False)]}"/>
                            <field name="refused_reason" attrs="{'invisible': [('refused', '=', False)]}"/>
                        </group>
                    </page>
                </xpath>
                <xpath expr="//button[@name='button_confirm']" position="before">
                    <field name="approve_refuse_buttons_visible" invisible="1"/>
                    <button string="Refuse" type="object" class="oe_highlight" name="action_refuse_po" attrs="{'invisible': ['|', '|', '|', ('approved', '=', True), ('refused', '=', True), ('to_be_approved', '=', False), ('approve_refuse_buttons_visible', '=', False)]}"/>
                    <button string="Unrefuse" type="object" class="oe_highlight" name="action_unrefuse_po" attrs="{'invisible': [('refused', '=', False)]}"/>
                    <button string="Approve" type="object" class="oe_highlight" name="action_approve_po" attrs="{'invisible': ['|', '|', '|', ('approved', '=', True), ('refused', '=', True), ('to_be_approved', '=', False), ('approve_refuse_buttons_visible', '=', False)]}"/>
                </xpath>
                <xpath expr="//button[@id='bid_confirm']" position="replace">
                    <button
                        name="button_confirm"
                        type="object"
                        string="Confirm Order"
                        class="oe_highlight"
                        id="bid_confirm"
                        attrs="{'invisible':['|', '|', ('state','not in',['sent']), ('refused', '=', True), '&amp;', ('approved', '=', False), ('to_be_approved', '=', True)]}"
                        groups="purchase.group_purchase_user,bouygues.bouygues_manager_sales_group,bouygues.bouygues_supplier_sales_group"/>
                </xpath>
                <xpath expr="//button[@id='draft_confirm']" position="replace">
                    <button
                        name="button_confirm"
                        type="object"
                        string="Confirm Order"
                        class="oe_highlight"
                        id="draft_confirm"
                        attrs="{'invisible':['|', '|', ('state','not in',['draft']), ('refused', '=', True), '&amp;', ('approved', '=', False), ('to_be_approved', '=', True)]}"
                        groups="purchase.group_purchase_user,bouygues.bouygues_manager_sales_group,bouygues.bouygues_supplier_sales_group"/>
                </xpath>
                <xpath expr="//button[@name='button_cancel']" position="attributes">
                    <attribute name="groups">purchase.group_purchase_user,bouygues.bouygues_manager_sales_group,bouygues.bouygues_supplier_sales_group</attribute>
                </xpath>
                <xpath expr="//sheet//button[@name='action_view_invoice'][1]" position="attributes">
                    <attribute name="groups">purchase.group_purchase_user,bouygues.bouygues_manager_sales_group</attribute>
                </xpath>
                <xpath expr="//button[@name='action_view_invoice'][1]" position="attributes">
                    <attribute name="groups">purchase.group_purchase_user,bouygues.bouygues_manager_sales_group</attribute>
                </xpath>
                <xpath expr="//button[@name='action_view_invoice'][2]" position="attributes">
                    <attribute name="groups">purchase.group_purchase_user,bouygues.bouygues_manager_sales_group</attribute>
                </xpath>
                <xpath expr="//button[@name='button_confirm'][1]" position="attributes">
                    <attribute name="groups">purchase.group_purchase_user,bouygues.bouygues_manager_sales_group,bouygues.bouygues_supplier_sales_group</attribute>
                </xpath>
                <xpath expr="//button[@name='button_confirm'][2]" position="attributes">
                    <attribute name="groups">purchase.group_purchase_user,bouygues.bouygues_manager_sales_group,bouygues.bouygues_supplier_sales_group</attribute>
                </xpath>
            </field>
        </record>
        <record id="bouygues_purchase_order_view_form_inherit_view" model="ir.ui.view">
            <field name="name">bouygues.purchase.order.view.form.inherit</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase_stock.purchase_order_view_form_inherit"/>
            <field name="arch" type="xml">
                <xpath expr="//sheet//button[@name='action_view_picking']" position="before">
                    <button type="object"
                       name="action_view_subcontract_pickings"
                       class="oe_stat_button"
                       icon="fa-truck"
                       attrs="{'invisible': [('subcontract_picking_count', '=', 0)]}">
                       <field name="subcontract_picking_count" widget="statinfo" string="Delivery"/>
                    </button>
                </xpath>
                <xpath expr="//header//button[@name='action_view_picking']" position="attributes">
                    <attribute name="groups">purchase.group_purchase_manager,bouygues.bouygues_manager_sales_group,bouygues.bouygues_supplier_sales_group,bouygues.bouygues_logistic_sales_group</attribute>
                </xpath>
            </field>
        </record>
        <record id="bouygues_purchase_order_tree_view" model="ir.ui.view">
            <field name="name">bouygues.purchase.order.tree</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='state']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='state']" position="after">
                    <field name="po_state" string="Status"/>
                </xpath>
                <xpath expr="//field[@name='user_id']" position="before">
                    <field name="responsible_id"/>
                </xpath>
                <xpath expr="//field[@name='date_order']" position="replace">
                    <field name="create_date" string="Order Date"/>
                </xpath>
            </field>
        </record>
        <record id="bouygues_purchase_order_tree_view_2" model="ir.ui.view">
            <field name="name">bouygues.sale.purchase.tree.2</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_view_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='invoice_status']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='user_id']" position="before">
                    <field name="responsible_id"/>
                </xpath>
                <xpath expr="//field[@name='invoice_status']" position="after">
                    <field name="po_state" string="Status"/>
                </xpath>
            </field>
        </record>
        <record id="bouygues_purchase_order_search_view" model="ir.ui.view">
            <field name="name">bouygues.purchase.order.search</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.view_purchase_order_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='product_id']" position="after">
                    <field name="origin" string="Origin" filter_domain="[('origin', 'ilike', self)]" />
                </xpath>
            </field>
        </record>

        <record id="bouygues_action_stock_picking_in" model="ir.actions.act_window">
            <field name="name">Receptions</field>
            <field name="type">ir.actions.act_window</field>
            <field name="domain">[('picking_type_code', '=', 'incoming')]</field>
            <field name="res_model">stock.picking</field>
            <field name="context">{'search_default_my_transfers': 1}</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="stock.vpicktree"/>
        </record>

        <menuitem action="bouygues_action_stock_picking_in" id="menu_bouygues_action_stock_picking_in" parent="purchase.menu_purchase_root" sequence="40"/>

        <!-- Purchase -->
        <record id="purchase.menu_purchase_root" model="ir.ui.menu">
            <field name="groups_id" eval="[
                (4, ref('bouygues.bouygues_supplier_sales_group')),
                (4, ref('bouygues.bouygues_logistic_sales_group')),
                (4, ref('bouygues.bouygues_trade_sales_group')),
                (4, ref('bouygues.bouygues_manager_sales_group')),
            ]"/>
        </record>
        <!-- Purchase/Orders/Vendors -->
        <record id="purchase.menu_procurement_management_supplier_name" model="ir.ui.menu">
            <field name="groups_id" eval="[(6, 0, [
                ref('purchase.group_purchase_manager'),
                ref('purchase.group_purchase_user'),
                ref('bouygues.bouygues_supplier_sales_group'),
                ref('bouygues.bouygues_logistic_sales_group'),
                ref('bouygues.bouygues_trade_sales_group'),
                ref('bouygues.bouygues_manager_sales_group'),
            ])]"/>
        </record>
        <!-- Purchase/Products -->
        <record id="purchase.menu_purchase_products" model="ir.ui.menu">
            <field name="groups_id" eval="[(6, 0, [
                ref('purchase.group_purchase_manager'),
                ref('purchase.group_purchase_user'),
                ref('bouygues.bouygues_supplier_sales_group'),
                ref('bouygues.bouygues_logistic_sales_group'),
                ref('bouygues.bouygues_manager_sales_group'),
            ])]"/>
        </record>
        <!-- Purchase/Reporting -->
        <record id="purchase.purchase_report" model="ir.ui.menu">
            <field name="groups_id" eval="[(6, 0, [
                ref('purchase.group_purchase_manager'),
                ref('purchase.group_purchase_user'),
                ref('bouygues.bouygues_supplier_sales_group'),
                ref('bouygues.bouygues_manager_sales_group'),
            ])]"/>
        </record>
        <!-- Purchase/Reporting/Purchase Analysis -->
        <record id="purchase.menu_report_purchase" model="ir.ui.menu">
            <field name="groups_id" eval="[
                (4, ref('purchase.group_purchase_manager')),
                (4, ref('bouygues.bouygues_supplier_sales_group')),
                (4, ref('bouygues.bouygues_manager_sales_group')),
            ]"/>
        </record>
        <!-- Purchase/Config -->
        <record id="purchase.menu_purchase_config" model="ir.ui.menu">
            <field name="groups_id" eval="[(6, 0, [
                ref('purchase.group_purchase_manager'),
                ref('bouygues.bouygues_supplier_sales_group'),
                ref('bouygues.bouygues_trade_extended_sales_group'),
                ref('bouygues.bouygues_manager_sales_group'),
            ])]"/>
        </record>
    </data>
</odoo>
